import torch
from transformers import AutoTokenizer, AutoModelForCausalLM, BitsAndBytesConfig
from peft import PeftModel

MODEL_NAME = "Qwen/Qwen2-1.5B-Instruct"
LORA_PATH = "checkpoints/stage2"   # change if needed

def load_model():
    tokenizer = AutoTokenizer.from_pretrained(
        MODEL_NAME,
        trust_remote_code=True,
        padding_side="left",
    )
    tokenizer.pad_token = tokenizer.eos_token

    quant_config = BitsAndBytesConfig(
        load_in_4bit=True,
        bnb_4bit_compute_dtype=torch.float16,
        bnb_4bit_quant_type="nf4",
        bnb_4bit_use_double_quant=True,
    )

    base_model = AutoModelForCausalLM.from_pretrained(
        MODEL_NAME,
        quantization_config=quant_config,
        device_map={"": "cuda:0"},   # force GPU
        trust_remote_code=True,
    )

    model = PeftModel.from_pretrained(
        base_model,
        LORA_PATH,
    )

    model.eval()
    return tokenizer, model


def run_inference(tokenizer, model, messages, max_new_tokens=32):
    prompt = tokenizer.apply_chat_template(
        messages,
        tokenize=False,
        add_generation_prompt=True,
    )

    inputs = tokenizer(
        prompt,
        return_tensors="pt",
    ).to(model.device)

    with torch.no_grad():
        outputs = model.generate(
            **inputs,
            max_new_tokens=max_new_tokens,
            do_sample=False,      # deterministic (important for RCA)
            temperature=0.0,
            top_p=1.0,
            pad_token_id=tokenizer.eos_token_id,
        )

    decoded = tokenizer.decode(
        outputs[0][inputs["input_ids"].shape[-1]:],
        skip_special_tokens=True,
    )

    return decoded.strip()


if __name__ == "__main__":
    tokenizer, model = load_model()
    messages = [
        {"role": "user", "content": "Analyze the 5G wireless network drive-test user plane data and engineering parameters.\nIdentify the reason for the throughput dropping below 600Mbps in certain road sections.\nFrom the following 8 potential root causes, select the most likely one and enclose its number in \\boxed{{}} in the final answer.\n\nC1: The serving cell's downtilt angle is too large, causing weak coverage at the far end.\nC2: The serving cell's coverage distance exceeds 1km, resulting in over-shooting.\nC3: A neighboring cell provides higher throughput.\nC4: Non-colocated co-frequency neighboring cells cause severe overlapping coverage.\nC5: Frequent handovers degrade performance.\nC6: Neighbor cell and serving cell have the same PCI mod 30, leading to interference.\nC7: Test vehicle speed exceeds 40km/h, impacting user throughput.\nC8: Average scheduled RBs are below 160, affecting throughput.\n\nGiven:\n- The default electronic downtilt value is 255, representing a downtilt angle of 6 degrees. Other values represent the actual downtilt angle in degrees.\n\nBeam Scenario and Vertical Beamwidth Relationships:\n- When the cell's Beam Scenario is set to Default or SCENARIO_1 to SCENARIO_5, the vertical beamwidth is 6 degrees.\n- When the cell's Beam Scenario is set to SCENARIO_6 to SCENARIO_11, the vertical beamwidth is 12 degrees.\n- When the cell's Beam Scenario is set to SCENARIO_12 or above, the vertical beamwidth is 25 degrees.\n\nUser plane drive test data as follows\uff1a\n\nTimestamp|Longitude|Latitude|GPS Speed (km/h)|5G KPI PCell RF Serving PCI|5G KPI PCell RF Serving SS-RSRP [dBm]|5G KPI PCell RF Serving SS-SINR [dB]|5G KPI PCell Layer2 MAC DL Throughput [Mbps]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 1 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 2 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 3 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 4 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 5 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 1 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 2 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 3 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 4 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 5 Filtered Tx BRSRP [dBm]|5G KPI PCell Layer1 DL RB Num (Including 0)\n2025-05-07 15:01:42.000000|128.186012|32.581026|8|764|-85.74|19.55|1288.9|217|185|106|-|-|-93.33|-99.33|-111.86|-|-|211.45\n2025-05-07 15:01:43.000000|128.186048|32.581045|71|764|-85.4|20.22|523.93|217|185|-|-|-|-89.33|-100.53|-|-|-|211.23\n2025-05-07 15:01:44.000000|128.186084|32.581076|50|764|-86.87|16.23|450.87|217|185|-|-|-|-86.98|-104.22|-|-|-|211.37\n2025-05-07 15:01:45.000000|128.186113|32.581087|65|217|-87.34|17.29|475.49|764|185|-|-|-|-87.18|-101.97|-|-|-|211.19\n2025-05-07 15:01:46.000000|128.186135|32.581094|44|217|-86.39|17.5|485.32|764|185|-|-|-|-88.65|-107.42|-|-|-|210.91\n2025-05-07 15:01:47.000000|128.186142|32.581105|31|217|-83.71|17.05|1214.89|764|185|-|-|-|-87.32|-103.16|-|-|-|210.81\n2025-05-07 15:01:48.000000|128.186157|32.581105|34|217|-80.56|20.05|1278.44|764|185|-|-|-|-84.65|-103.25|-|-|-|211.5\n2025-05-07 15:01:49.000000|128.186163|32.581105|2|217|-82.43|17.62|1143.99|764|185|-|-|-|-86.24|-105.63|-|-|-|211.27\n2025-05-07 15:01:50.000000|128.186171|32.581094|9|217|-85.74|16.73|1271.78|764|185|-|-|-|-84.46|-106.94|-|-|-|211.42\n2025-05-07 15:01:51.000000|128.186192|32.581094|27|217|-83.66|17.82|1259.53|764|185|-|-|-|-86.23|-106.4|-|-|-|211.01\n\n\nEngeneering parameters data as follows\uff1a\n\ngNodeB ID|Cell ID|Longitude|Latitude|Mechanical Azimuth|Mechanical Downtilt|Digital Tilt|Digital Azimuth|Beam Scenario|Height|PCI|TxRx Mode|Max Transmit Power|Antenna Model\n0033978|12|128.195584|32.588838|55|9|255|0|DEFAULT|39.2|435|32T32R|34.9|NR AAU 3\n0033317|13|128.186768|32.580619|5|5|6|0|DEFAULT|17.4|217|32T32R|34.9|NR AAU 1\n0033164|29|128.185159|32.58158|195|8|12|0|DEFAULT|31.6|185|32T32R|34.9|NR AAU 1\n0033162|2|128.185963|32.566443|300|8|12|0|DEFAULT|34.0|106|64T64R|34.9|NR AAU 2\n0033317|16|128.186731|32.580677|300|11|0|0|DEFAULT|16.0|764|64T64R|34.9|NR AAU 2\n0033317|14|128.185073|32.579638|55|10|11|0|DEFAULT|25.9|96|64T64R|34.9|NR AAU 2\n0000590|53|128.177802|32.597536|0|0|255|0|DEFAULT|0.0|720|4T4R|46.0|Other\n"},
        {"role": "user", "content": "Analyze the 5G wireless network drive-test user plane data and engineering parameters.\nIdentify the reason for the throughput dropping below 600Mbps in certain road sections.\nFrom the following 8 potential root causes, select the most likely one and enclose its number in \\boxed{{}} in the final answer.\n\nC1: The serving cell's downtilt angle is too large, causing weak coverage at the far end.\nC2: The serving cell's coverage distance exceeds 1km, resulting in over-shooting.\nC3: A neighboring cell provides higher throughput.\nC4: Non-colocated co-frequency neighboring cells cause severe overlapping coverage.\nC5: Frequent handovers degrade performance.\nC6: Neighbor cell and serving cell have the same PCI mod 30, leading to interference.\nC7: Test vehicle speed exceeds 40km/h, impacting user throughput.\nC8: Average scheduled RBs are below 160, affecting throughput.\n\nGiven:\n- The default electronic downtilt value is 255, representing a downtilt angle of 6 degrees. Other values represent the actual downtilt angle in degrees.\n\nBeam Scenario and Vertical Beamwidth Relationships:\n- When the cell's Beam Scenario is set to Default or SCENARIO_1 to SCENARIO_5, the vertical beamwidth is 6 degrees.\n- When the cell's Beam Scenario is set to SCENARIO_6 to SCENARIO_11, the vertical beamwidth is 12 degrees.\n- When the cell's Beam Scenario is set to SCENARIO_12 or above, the vertical beamwidth is 25 degrees.\n\nUser plane drive test data as follows\uff1a\n\nTimestamp|Longitude|Latitude|GPS Speed (km/h)|5G KPI PCell RF Serving PCI|5G KPI PCell RF Serving SS-RSRP [dBm]|5G KPI PCell RF Serving SS-SINR [dB]|5G KPI PCell Layer2 MAC DL Throughput [Mbps]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 1 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 2 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 3 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 4 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 5 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 1 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 2 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 3 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 4 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 5 Filtered Tx BRSRP [dBm]|5G KPI PCell Layer1 DL RB Num (Including 0)\n2025-05-07 16:25:36.000000|128.187325|32.577132|10|729|-73.15|17.67|943.43|394|481|-|-|-|-80.48|-96.34|-|-|-|203.61\n2025-05-07 16:25:37.000000|128.187317|32.577075|30|729|-76.45|16.63|793.62|394|481|-|-|-|-82.22|-98.85|-|-|-|193.92\n2025-05-07 16:25:38.000000|128.187288|32.577014|30|729|-80.48|11.58|1006.87|394|481|-|-|-|-80.63|-93.74|-|-|-|188.36\n2025-05-07 16:25:39.000000|128.187258|32.576953|13|729|-81.41|17.12|300.38|394|481|-|-|-|-79.8|-98.34|-|-|-|205.92\n2025-05-07 16:25:40.000000|128.187222|32.576874|26|729|-80.73|10.75|264.49|394|481|-|-|-|-82.7|-94.59|-|-|-|200.11\n2025-05-07 16:25:41.000000|128.188315|32.576554|34|394|-88.89|8.43|497.9|729|481|-|-|-|-89.05|-99.2|-|-|-|200.16\n2025-05-07 16:25:42.000000|128.187169|32.576744|39|394|-85.17|10.3|457.84|729|481|-|-|-|-89.65|-99.93|-|-|-|171.17\n2025-05-07 16:25:43.000000|128.187155|32.576694|36|394|-88.03|9.15|676.51|729|481|170|709|357|-96.38|-101.44|-106.96|-112.66|-122.97|202.61\n2025-05-07 16:25:44.000000|128.187126|32.576645|23|394|-86.4|10.87|774.07|729|481|170|284|732|-93.74|-99.56|-106.66|-114.48|-118.19|206.31\n2025-05-07 16:25:45.000000|128.18709|32.576615|18|394|-88.0|10.75|836.62|729|481|507|357|170|-90.11|-101.31|-108.05|-119.78|-124.26|204.89\n\n\nEngeneering parameters data as follows\uff1a\n\ngNodeB ID|Cell ID|Longitude|Latitude|Mechanical Azimuth|Mechanical Downtilt|Digital Tilt|Digital Azimuth|Beam Scenario|Height|PCI|TxRx Mode|Max Transmit Power|Antenna Model\n0034038|28|128.186758|32.57687|70|8|255|0|DEFAULT|24.0|729|64T64R|34.9|NR AAU 2\n0034038|27|128.18869|32.577204|260|15|6|0|DEFAULT|35.2|732|32T32R|34.9|NR AAU 3\n0033286|58|128.187109|32.574817|320|9|13|0|DEFAULT|24.0|481|32T32R|34.9|NR AAU 1\n0034038|26|128.186786|32.576813|240|19|6|0|SCENARIO_7|28.0|394|32T32R|34.9|NR AAU 1\n0034038|0|128.18743|32.577968|179|41|13|0|DEFAULT|56.0|357|64T64R|34.9|NR AAU 2\n0034039|4|128.192305|32.578727|255|20|255|0|DEFAULT|111.0|656|64T64R|34.9|NR AAU 2\n0033166|26|128.190492|32.575416|230|17|4|20|SCENARIO_4|48.1|170|64T64R|34.9|NR AAU 2\n0034038|24|128.187331|32.577858|40|44|9|10|SCENARIO_9|56.0|284|64T64R|34.9|NR AAU 2\n0033286|62|128.187109|32.574817|140|0|6|20|SCENARIO_13|20.0|507|32T32R|34.9|NR AAU 1\n"},
        {"role": "user", "content": "Analyze the 5G wireless network drive-test user plane data and engineering parameters.\nIdentify the reason for the throughput dropping below 600Mbps in certain road sections.\nFrom the following 8 potential root causes, select the most likely one and enclose its number in \\boxed{{}} in the final answer.\n\nC1: The serving cell's downtilt angle is too large, causing weak coverage at the far end.\nC2: The serving cell's coverage distance exceeds 1km, resulting in over-shooting.\nC3: A neighboring cell provides higher throughput.\nC4: Non-colocated co-frequency neighboring cells cause severe overlapping coverage.\nC5: Frequent handovers degrade performance.\nC6: Neighbor cell and serving cell have the same PCI mod 30, leading to interference.\nC7: Test vehicle speed exceeds 40km/h, impacting user throughput.\nC8: Average scheduled RBs are below 160, affecting throughput.\n\nGiven:\n- The default electronic downtilt value is 255, representing a downtilt angle of 6 degrees. Other values represent the actual downtilt angle in degrees.\n\nBeam Scenario and Vertical Beamwidth Relationships:\n- When the cell's Beam Scenario is set to Default or SCENARIO_1 to SCENARIO_5, the vertical beamwidth is 6 degrees.\n- When the cell's Beam Scenario is set to SCENARIO_6 to SCENARIO_11, the vertical beamwidth is 12 degrees.\n- When the cell's Beam Scenario is set to SCENARIO_12 or above, the vertical beamwidth is 25 degrees.\n\nUser plane drive test data as follows\uff1a\n\nTimestamp|Longitude|Latitude|GPS Speed (km/h)|5G KPI PCell RF Serving PCI|5G KPI PCell RF Serving SS-RSRP [dBm]|5G KPI PCell RF Serving SS-SINR [dB]|5G KPI PCell Layer2 MAC DL Throughput [Mbps]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 1 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 2 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 3 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 4 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 5 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 1 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 2 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 3 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 4 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 5 Filtered Tx BRSRP [dBm]|5G KPI PCell Layer1 DL RB Num (Including 0)\n2025-05-07 15:14:22.000000|128.187332|32.582315|35|217|-88.34|20.17|1188.72|96|185|-|-|-|-106.23|-110.75|-|-|-|211.03\n2025-05-07 15:14:23.000000|128.187332|32.582315|12|217|-87.16|20.2|1086.81|96|185|-|-|-|-105.05|-109.72|-|-|-|210.77\n2025-05-07 15:14:24.000000|128.187332|32.582315|34|217|-86.4|20.07|1025.33|96|185|-|-|-|-107.06|-110.67|-|-|-|210.52\n2025-05-07 15:14:25.000000|128.187332|32.582315|70|217|-89.25|20.07|365.2|96|185|-|-|-|-105.08|-112.42|-|-|-|210.58\n2025-05-07 15:14:26.000000|128.187332|32.582315|74|217|-86.1|20.05|341.75|96|185|-|-|-|-106.15|-113.92|-|-|-|210.54\n2025-05-07 15:14:27.000000|128.187332|32.582315|59|96|-88.04|20.14|377.71|217|185|227|-|-|-106.26|-113.2|-128.65|-|-|210.93\n2025-05-07 15:14:28.000000|128.187332|32.582315|65|96|-86.55|20.36|407.75|217|185|-|-|-|-105.53|-111.76|-|-|-|209.98\n2025-05-07 15:14:29.000000|128.187332|32.582315|1|96|-89.48|20.58|772.66|217|185|-|-|-|-106.35|-113.04|-|-|-|193.0\n2025-05-07 15:14:30.000000|128.187332|32.582315|14|96|-87.2|20.51|799.28|217|185|-|-|-|-105.36|-113.22|-|-|-|211.02\n2025-05-07 15:14:31.000000|128.187332|32.582315|20|96|-89.01|20.51|976.53|217|185|-|-|-|-106.83|-112.78|-|-|-|210.85\n\n\nEngeneering parameters data as follows\uff1a\n\ngNodeB ID|Cell ID|Longitude|Latitude|Mechanical Azimuth|Mechanical Downtilt|Digital Tilt|Digital Azimuth|Beam Scenario|Height|PCI|TxRx Mode|Max Transmit Power|Antenna Model\n0033978|12|128.195688|32.588853|55|9|255|0|DEFAULT|39.2|435|32T32R|34.9|NR AAU 3\n0034036|14|128.200545|32.594668|0|0|255|0|EXPAND_SCENARIO_2|0.0|868|4T4R|46.0|Other\n0033317|14|128.185177|32.579653|55|10|11|0|DEFAULT|25.9|96|64T64R|34.9|NR AAU 2\n0033164|29|128.185263|32.581595|195|8|12|0|DEFAULT|31.6|185|32T32R|34.9|NR AAU 1\n0033162|2|128.186067|32.566458|300|8|12|0|DEFAULT|34.0|106|64T64R|34.9|NR AAU 2\n0000293|0|128.175699|32.589435|192|9|7|0|SCENARIO_9|3.0|660|64T64R|34.9|NR AAU 2\n0033317|13|128.186872|32.580634|10|5|0|0|DEFAULT|17.4|217|32T32R|34.9|NR AAU 1\n"},
        {"role": "user", "content": "Analyze the 5G wireless network drive-test user plane data and engineering parameters.\nIdentify the reason for the throughput dropping below 600Mbps in certain road sections.\nFrom the following 8 potential root causes, select the most likely one and enclose its number in \\boxed{{}} in the final answer.\n\nC1: The serving cell's downtilt angle is too large, causing weak coverage at the far end.\nC2: The serving cell's coverage distance exceeds 1km, resulting in over-shooting.\nC3: A neighboring cell provides higher throughput.\nC4: Non-colocated co-frequency neighboring cells cause severe overlapping coverage.\nC5: Frequent handovers degrade performance.\nC6: Neighbor cell and serving cell have the same PCI mod 30, leading to interference.\nC7: Test vehicle speed exceeds 40km/h, impacting user throughput.\nC8: Average scheduled RBs are below 160, affecting throughput.\n\nGiven:\n- The default electronic downtilt value is 255, representing a downtilt angle of 6 degrees. Other values represent the actual downtilt angle in degrees.\n\nBeam Scenario and Vertical Beamwidth Relationships:\n- When the cell's Beam Scenario is set to Default or SCENARIO_1 to SCENARIO_5, the vertical beamwidth is 6 degrees.\n- When the cell's Beam Scenario is set to SCENARIO_6 to SCENARIO_11, the vertical beamwidth is 12 degrees.\n- When the cell's Beam Scenario is set to SCENARIO_12 or above, the vertical beamwidth is 25 degrees.\n\nUser plane drive test data as follows\uff1a\n\nTimestamp|Longitude|Latitude|GPS Speed (km/h)|5G KPI PCell RF Serving PCI|5G KPI PCell RF Serving SS-RSRP [dBm]|5G KPI PCell RF Serving SS-SINR [dB]|5G KPI PCell Layer2 MAC DL Throughput [Mbps]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 1 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 2 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 3 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 4 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 5 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 1 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 2 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 3 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 4 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 5 Filtered Tx BRSRP [dBm]|5G KPI PCell Layer1 DL RB Num (Including 0)\n2025-05-07 14:45:32.000000|128.188445|32.580032|5|71|-76.17|15.46|1007.61|307|712|-|-|-|-87.33|-93.93|-|-|-|210.08\n2025-05-07 14:45:33.000000|128.18843|32.579983|36|71|-77.69|14.73|999.59|307|712|368|284|-|-88.64|-95.14|-107.65|-117.36|-|209.82\n2025-05-07 14:45:34.000000|128.188401|32.579925|34|71|-76.68|10.64|943.44|307|712|-|-|-|-86.5|-90.86|-|-|-|211.22\n2025-05-07 14:45:35.000000|128.188378|32.579865|15|71|-77.13|10.3|912.66|307|712|-|-|-|-86.84|-89.62|-|-|-|209.44\n2025-05-07 14:45:36.000000|128.188363|32.579804|11|71|-79.22|8.57|861.82|307|712|-|-|-|-81.04|-88.48|-|-|-|207.86\n2025-05-07 14:45:37.000000|128.188341|32.579755|19|71|-83.17|7.11|262.31|712|307|129|284|-|-77.99|-87.06|-93.41|-113.42|-|207.88\n2025-05-07 14:45:38.000000|128.188333|32.579716|19|71|-80.23|2.95|319.87|712|307|284|258|-|-82.55|-90.55|-110.24|-111.41|-|209.43\n2025-05-07 14:45:39.000000|128.188311|32.579686|5|307|-87.17|4.18|198.27|712|71|284|258|-|-87.2|-89.42|-102.95|-117.85|-|207.41\n2025-05-07 14:45:40.000000|128.188311|32.579667|12|307|-87.23|2.87|283.13|712|71|284|258|-|-87.96|-91.69|-103.61|-116.86|-|211.09\n2025-05-07 14:45:41.000000|128.188304|32.579644|35|307|-85.71|6.26|911.91|71|712|284|258|-|-86.63|-95.02|-106.39|-110.21|-|210.88\n\n\nEngeneering parameters data as follows\uff1a\n\ngNodeB ID|Cell ID|Longitude|Latitude|Mechanical Azimuth|Mechanical Downtilt|Digital Tilt|Digital Azimuth|Beam Scenario|Height|PCI|TxRx Mode|Max Transmit Power|Antenna Model\n0033164|14|128.189134|32.580993|150|20|255|0|DEFAULT|28.7|129|64T64R|34.9|NR AAU 2\n0033164|27|128.189086|32.58093|200|1|10|0|DEFAULT|29.7|71|32T32R|34.9|NR AAU 1\n0034038|4|128.187926|32.579079|30|8|4|0|DEFAULT|5.0|712|64T64R|34.9|NR AAU 2\n0033164|26|128.189105|32.580974|60|2|9|0|DEFAULT|26.6|307|32T32R|34.9|NR AAU 1\n0034038|2|128.187935|32.579049|140|10|4|0|DEFAULT|5.0|258|64T64R|34.9|NR AAU 2\n0033164|24|128.188889|32.581767|235|15|9|0|DEFAULT|22.1|368|32T32R|34.9|NR AAU 1\n0034038|24|128.187343|32.57786|40|44|9|10|SCENARIO_9|56.0|284|64T64R|34.9|NR AAU 2\n"},
        {"role": "user", "content": "Analyze the 5G wireless network drive-test user plane data and engineering parameters.\nIdentify the reason for the throughput dropping below 600Mbps in certain road sections.\nFrom the following 8 potential root causes, select the most likely one and enclose its number in \\boxed{{}} in the final answer.\n\nC1: The serving cell's downtilt angle is too large, causing weak coverage at the far end.\nC2: The serving cell's coverage distance exceeds 1km, resulting in over-shooting.\nC3: A neighboring cell provides higher throughput.\nC4: Non-colocated co-frequency neighboring cells cause severe overlapping coverage.\nC5: Frequent handovers degrade performance.\nC6: Neighbor cell and serving cell have the same PCI mod 30, leading to interference.\nC7: Test vehicle speed exceeds 40km/h, impacting user throughput.\nC8: Average scheduled RBs are below 160, affecting throughput.\n\nGiven:\n- The default electronic downtilt value is 255, representing a downtilt angle of 6 degrees. Other values represent the actual downtilt angle in degrees.\n\nBeam Scenario and Vertical Beamwidth Relationships:\n- When the cell's Beam Scenario is set to Default or SCENARIO_1 to SCENARIO_5, the vertical beamwidth is 6 degrees.\n- When the cell's Beam Scenario is set to SCENARIO_6 to SCENARIO_11, the vertical beamwidth is 12 degrees.\n- When the cell's Beam Scenario is set to SCENARIO_12 or above, the vertical beamwidth is 25 degrees.\n\nUser plane drive test data as follows\uff1a\n\nTimestamp|Longitude|Latitude|GPS Speed (km/h)|5G KPI PCell RF Serving PCI|5G KPI PCell RF Serving SS-RSRP [dBm]|5G KPI PCell RF Serving SS-SINR [dB]|5G KPI PCell Layer2 MAC DL Throughput [Mbps]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 1 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 2 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 3 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 4 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 5 PCI|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 1 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 2 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 3 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 4 Filtered Tx BRSRP [dBm]|Measurement PCell Neighbor Cell Top Set(Cell Level) Top 5 Filtered Tx BRSRP [dBm]|5G KPI PCell Layer1 DL RB Num (Including 0)\n2025-05-07 14:21:22.000000|128.186911|32.584055|5|330|-88.89|23.99|910.24|591|660|597|-|-|-108.46|-114.13|-121.7|-|-|205.46\n2025-05-07 14:21:23.000000|128.186911|32.584055|27|330|-89.36|24.9|902.26|591|660|597|-|-|-107.7|-114.35|-125.38|-|-|207.8\n2025-05-07 14:21:24.000000|128.185869|32.585626|9|330|-87.0|24.09|782.18|591|660|597|-|-|-108.21|-117.02|-123.07|-|-|198.74\n2025-05-07 14:21:25.000000|128.186911|32.584055|14|330|-89.02|24.2|866.73|591|660|597|-|-|-108.78|-118.51|-123.08|-|-|206.74\n2025-05-07 14:21:26.000000|128.186911|32.584055|22|660|-89.33|24.58|360.01|591|330|597|-|-|-110.69|-117.2|-123.87|-|-|207.83\n2025-05-07 14:21:27.000000|128.186911|32.584055|22|660|-85.93|23.51|348.49|591|330|597|-|-|-109.36|-116.58|-122.59|-|-|202.36\n2025-05-07 14:21:28.000000|128.186911|32.584055|15|660|-85.11|23.68|347.63|330|591|597|-|-|-108.73|-116.33|-121.83|-|-|206.61\n2025-05-07 14:21:29.000000|128.186911|32.584055|33|660|-85.34|24.27|326.91|330|591|597|-|-|-110.65|-117.25|-123.82|-|-|201.3\n2025-05-07 14:21:30.000000|128.186911|32.584055|29|591|-84.6|24.55|849.27|330|660|597|-|-|-110.11|-117.76|-122.16|-|-|202.67\n2025-05-07 14:21:31.000000|128.186911|32.584055|21|591|-88.44|24.61|827.11|330|660|597|-|-|-109.49|-118.24|-125.74|-|-|206.82\n\n\nEngeneering parameters data as follows\uff1a\n\ngNodeB ID|Cell ID|Longitude|Latitude|Mechanical Azimuth|Mechanical Downtilt|Digital Tilt|Digital Azimuth|Beam Scenario|Height|PCI|TxRx Mode|Max Transmit Power|Antenna Model\n0000293|0|128.203985|32.589187|192|9|7|0|SCENARIO_9|3.0|660|64T64R|34.9|NR AAU 2\n0033164|5|128.186986|32.585957|170|5|9|0|DEFAULT|51.1|591|32T32R|34.9|NR AAU 3\n0033164|4|128.18644|32.584389|120|14|13|10|SCENARIO_4|52.9|330|32T32R|34.9|NR AAU 3\n0033286|14|128.179948|32.574116|60|7|13|0|SCENARIO_3|56.0|597|32T32R|34.9|NR AAU 3\n"},
    ]

    result = run_inference(tokenizer, model, messages)
    print("Model output:")
    print(result)
